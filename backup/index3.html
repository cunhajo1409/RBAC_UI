<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>

    <meta name="viewport" content="width=device-width, initial-scale=1">   
    <meta charset="utf-8">    

    <title>Role Based Access Control</title>

    <link rel="stylesheet" href="RBAC_Site/Sites/RBAC/SiteAssets/jqueryui/jquery-ui.css">  
    <link rel="stylesheet" href="RBAC_Site/Sites/RBAC/SiteAssets/jqueryui/jquery-ui.theme.css">
    <link rel="stylesheet" href="RBAC_Site/Sites/RBAC/SiteAssets/jqueryui/jquery-ui.structure.css">
    <link rel="stylesheet" href="RBAC_Site/Sites/RBAC/SiteAssets/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="RBAC_Site/Sites/RBAC/SiteAssets/bootstrap/dist/css/bootstrap-grid.css">

    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2021.1.330/styles/kendo.common.min.css">
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2021.1.330/styles/kendo.rtl.min.css">
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2021.1.330/styles/kendo.default.min.css">
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2021.1.330/styles/kendo.mobile.all.min.css">

    <link rel="stylesheet" href="RBAC_Site/Sites/RBAC/SiteAssets/css/RBAC.css">

    <script src="RBAC_Site/Sites/RBAC/SiteAssets/jquery/dist/jquery.js"></script>
    <script src="RBAC_Site/Sites/RBAC/SiteAssets/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script src="RBAC_Site/Sites/RBAC/SiteAssets/jqueryui/jquery-ui.js"></script>
    <script src="RBAC_Site/Sites/RBAC/SiteAssets/bootstrap/dist/js/bootstrap.js"></script>

    <script src="https://kendo.cdn.telerik.com/2021.1.330/js/jszip.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2021.1.330/js/kendo.all.min.js"></script>    


    <script src="RBAC_Site/Sites/RBAC/SiteAssets/js/Globals.js"></script>

</head>
    <div id="container">
        <div id="divContentHeader" style="display:block;">

            <div id="divTitle" 
                 class="testClass"
                 style="display:block;
                        max-width: 600px;
                        margin: 10px auto;
                        padding-top: 40px;
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        font-size: 42px;">
                        Role Based Access Control           
            </div>
            <div id="divMenu" style="display:none;">
                <ul id="ulMenu">
                    <li>
                        Users
                        <ul>
                            <li>
                                Accounts
                            </li>
                            <li>
                                Account Types
                            </li>
                        </ul>
                    </li>

                    <li>
                        Groups
                    </li>
                    <li>
                        Scopes
                    </li>
                 
                    <li>
                        Projects
                    </li>
                    <li>
                        Roles
                    </li>
                    <li>
                        Types
                    </li>  
                </ul>
            </div>
        
        </div>

        <div id="divContent" style="display: block;">
            
            <div id="divADUserControls" class="contentArea"  style="display:none;">
                <div id="divADUsersCaption" 
                        style= "display:inline-flex;
                                max-width: 600px;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                    Users
                </div>  
                <div id="divADUserDetail" style="display:none">
                </div>
                <div id="divADUserEdit" style="display:none">
                </div>
                <script type="text/x-kendo-template" id="userGridTemplate">
                    <a id="userGridColMenu" style="float:right";"</a>
                </script>  
                <div id="divGrdADUsers" style="display:block">
                </div>

            </div>
            
            <div id="divADUserAccountTypeControls" class="contentArea"  style="display:none">
                <div id="divADUserAccountTypesCaption" 
                        style= "display:inline-flex;
                                max-width: 600px;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                    Account Types
                </div>  
                <div id="divADUserAccountTypeDetail" style="display:none">
                </div>
                <div id="divADUserAccountTypesEdit" style="display:none">
                </div>
                <div id="divGrdADUserAccountTypes" style="display:block">
                </div>                
            </div>
 
            <div id="divADGroupControls" class="contentArea" style="display:none;">
                <div id="divADGroupsCaption" 
                        style= "display:inline-flex;
                                min-width:fit-content;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                    Security Groups
                </div>                  
                <div id="divADGroupDetail" style="display:none">
                </div>
                <div id="divADGroupEdit" style="display:none">
                </div>             
                <div id="divGrdADGroups">
                </div>
            </div>
            
            <div id="divMIPGroupScopeControls" class="contentArea"  style="display:none">
                <div id="divMIPGroupScopeCaption" 
                        style= "display:inline-flex;
                                max-width: 600px;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                Scopes
                </div>  
                <div id="divMIPGroupScopeDetail" style="display:none">
                </div>
                <div id="divMIPGroupScopeEdit" style="display:none">
                </div>
                <div id="divGrdMIPGroupScopes" style="display:block">
                </div>                
            </div>
           
            <div id="divMIPGroupProjectControls" class="contentArea"  style="display:none">
                <div id="divMIPGroupProjectCaption" 
                        style= "display:inline-flex;
                                max-width: 600px;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                    Projects
                </div>  
                <div id="divMIPGroupProjectDetail" style="display:none">
                </div>
                <div id="divMIPGroupProjectEdit" style="display:none">
                </div>
                <div id="divGrdMIPGroupProjects" style="display:block">
                </div>                
            </div>
            
            <div id="divMIPGroupRoleControls" class="contentArea"  style="display:none">
                <div id="divMIPGroupRoleCaption" 
                        style= "display:inline-flex;
                                max-width: 600px;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                Roles
                </div>  
                <div id="divMIPGroupRoleDetail" style="display:none">
                </div>
                <div id="divMIPGroupRoleEdit" style="display:none">
                </div>
                <div id="divGrdMIPGroupRoles" style="display:block">
                </div>                
            </div>

            <div id="divMIPGroupTypeControls" class="contentArea"  style="display:none;">
                <div id="divADGroupTypeCaption" 
                        style= "display:inline-flex;
                                max-width: 600px;
                                margin: 10px auto;
                                padding-top: 20px;
                                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                font-size: 42px;
                                align-items:flex-start;">
                    Group Types
                </div> 
                <div id="divMIPGroupTypeDetail" style="display:none">
                </div>
                <div id="divMIPGroupTypeEdit" style="display:none">
                </div>
                <div id="divGrdMIPGroupTypes">
                </div>
            </div>
        </div>
    </div>
    <script>
        init();

        function init()
        {
            loadPage();
        }

        function loadPage()
        {
            $("#ulMenu").kendoMenu({
                select: function(e)
                {
                    var itemText = $(e.item).children(".k-link").text().trim();

                    $(".contentArea").hide();

                    switch (itemText) 
                    {
                        case "Accounts":
                            $("#divADUserControls").show();
                            break;
                        case "Account Types" :
                            $("#divADUserAccountTypeControls").show();
                            break;
                        case "Groups": 
                            // var grid = $("#divADGroupControls")
                            // grid.width(1200);
                            // $(grid).show();
                            $("#divADGroupControls").show();
                            break;
                        case "Scopes":
                            $("#divMIPGroupScopeControls").show();
                            break;
                        case "Projects":
                            $("#divMIPGroupProjectControls").show();
                            break;
                        case "Roles":
                            $("#divMIPGroupRoleControls").show();
                            break;
                        case "Types":
                            $("#divMIPGroupTypeControls").show();
                            break;
                    }
                }
            });

            $("#divMenu").show();

            $("#divGrdADUsers").kendoGrid(
            {
                dataSource:
                    {
                        type: "odata-v4",
                        transport: 
                            {
                                read: "https://localhost:44395/OData/ADUser"
                            },
                        pageSize: 30,
                    },
                height: 600,
                scrolable: true,
                filterable: true,
                pageable: true,
                sortable:
                {
                  mode:"multiple"
                },
                groupable: true,
                columnMenu: true, 
                columns:[   {selectable:true, width: 40},
                            {title:"Key", field:"user_key", width: 80},
                            {title:"Name", field:"name", width: 380},
                            {title:"User Name", field:"user_name", width: 190},
                            {title:"Company", field:"Company"},
                            {title:"Dept.", field:"Department", width: 190},
                            {title:"Title", field:"Title"},
                            {title:"EMail", field:"Email"},
                            {title:"Phone", field:"Telephone", width: 130},
                            {title:"Status", field:"Enabled", width: 70},
                            {title:"Expired", field:"AccountExpirationDate", width: 110},
                            {title:"Type", field:"AccountType", width: 60}],
            });

            $("#divGrdADUserAccountTypes").kendoGrid(
            {
                dataSource:
                    {
                        type: "odata-v4",
                        transport: 
                            {
                                read: "https://localhost:44395/OData/ADUserAccountType"
                            },
                        pageSize: 30,
                    },                
                height: 600,
                scrolable: true,
                filterable: true,
                pageable: true,
                sortable: {
                    mode:"mutiple"
                },
                groupable:true,
                columnMenu: true,
                columns:
                [
                    {title:"Key", field:"user_type_key", width: 60 },
                    {title:"Name", field:"user_type_name", width: 350 },
                    {title:"Description", field:"user_type_description"}
                ]                 
            });
            

            $("#divGrdADGroups").kendoGrid({
                dataSource:
                {
                     type: "odata-v4"
                    ,transport:
                    {
                         read: 
                        {
                            url: function()
                            {
                                return "https://localhost:44395/OData/ADGroup";
                            }
                        }
                        ,update:
                        {
                            url: function(dataItem)
                            {
                                return "https://localhost:44395/OData/ADGroup(" + dataItem.group_Key + ")";
                                
                            }
                        }
                        ,create:
                        {
                            url: function(dataItem)
                            {
                                return "https://localhost:44395/OData/ADGroup";
                            }
                        }
                        ,destroy:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/ADGroup(" + dataItem.group_Key + ")";
                                }
                            }
                            ,parameterMap: function(data,type)
                            {
                                console.log(type);
                                if (type == "create")
                                {
                                    delete data.group__key;
                                }
                                console.log(data);
                                return kendo.stringify(data);
                            }
                    }
                    ,sort:
                    {
                          field:'group_Key'
                        , dir: 'desc'
                    }
                    ,schema:
                    {    
                        model:
                        {
                             id: "group_Key"
                            ,fields: 
                            {
                                 group_Key:             { type: "number", editable:false}
                                ,group_id:              {
                                                                type:"string"
                                                            ,   attributes:{ "class" : "group-grid-field"}
                                                            // ,   validation:
                                                            //     {  
                                                            //          required: true   
                                                            //         ,validateGroupID : function(input)
                                                            //                 {
                                                            //                     if (input.is("[name='group_id']") && input.val().length > 55)
                                                            //                     {
                                                            //                         input.attr("data-validateGroup_id-msg","Length exceeds max of 55 characters");
                                                            //                         return false;
                                                            //                     }
                                                            //                     else
                                                            //                     {
                                                            //                         return true;
                                                            //                     }
                                                            //                 }
                                                            //     }
                                                        }
                                ,group_scope_code:      {   type:"string", defaultValue:"n/a"
                                                        ,   attributes:{ "class" : "group-grid-field"}
                                                        // ,   validation:
                                                        //     {
                                                        //         // required: (function(input)
                                                        //         //     {
                                                        //         //         if (input.is("[name='group_scope_code']") && $(input).hasClass("group-grid-field") )
                                                        //         //         {
                                                        //         //             return false;
                                                        //         //         }
                                                        //         //     })
                                                        //             // , 
                                                        //             validateGroupScopeCode : function(input)
                                                        //                 {
                                                        //                     if (input.is("[name='group_scope_code']") && $(input).hasClass("group-grid-field") && input.val().length > 6)
                                                        //                     {
                                                        //                         input.attr("data-validateGroupScopeCode-msg","Length exceeds max of 6 characters");
                                                        //                         return false;
                                                        //                     }
                                                        //                     else
                                                        //                     {
                                                        //                         return true;
                                                        //                     }
                                                        //                 }
                                                        //     }
                                                        }
                                ,group_project_code:    {   type:"string", attributes:{ "class" : "group-grid-field"}, defaultValue: "n/a"
                                                        // ,   validation:
                                                        //     {
                                                        //         required: (function(input)
                                                        //                     {
                                                        //                             if (input.is("[name='group_project_code']") && $(input).hasClass("group-grid-field"))
                                                        //                             {
                                                        //                                 return false;
                                                        //                             }
                                                        //                     })
                                                        //     }
                                                        }
                                ,group_role_code:       {   type:"string", attributes:{ "class" : "group-grid-field"}, defaultValue: "n/a"
                                                        // ,   validation:
                                                        //     {
                                                        //         required: (function(input)
                                                        //                     {
                                                        //                             if (input.is("[name='group_role_code']") && $(input).hasClass("group-grid-field"))
                                                        //                             {
                                                        //                                 return false;
                                                        //                             }
                                                        //                     })
                                                        //     }
                                                        }
                                ,group_type_code:       {   type:"string", attributes:{ "class" : "group-grid-field"}, defaultValue: "n/a"
                                                        // ,   validation:
                                                        //     {
                                                        //         required: (function(input)
                                                        //                     {
                                                        //                             if (input.is("[name='group_type_code']") && $(input).hasClass("type-grid-field"))
                                                        //                             {
                                                        //                                 return false;
                                                        //                             }
                                                        //                     })
                                                        //     }
                                                        }
                                ,group_description:  {type:"string", attributes:{ "class" : "group-grid-field"}}
                                ,group_object_category: {type:"string", attributes:{ "class" : "group-grid-field"}}
                                ,project_owner: {type:"string", attributes:{ "class" : "group-grid-field"}}
                                ,project_email: {type:"string", attributes:{ "class" : "group-grid-field"}}
                                ,project_telephone: {type:"string", attributes:{ "class" : "group-grid-field"}}
                                ,create_date: {type:"date", attributes:{ "class" : "group-grid-field"}, defaultValue:null}
                                ,last_updated_date: {type:"date", attributes:{ "class" : "group-grid-field"}, defaultValue:null}
                                ,inactivated_date: {type:"date", attributes:{ "class" : "group-grid-field"}, defaultValue:null}
                                ,group_project_key: {type:"number", attributes:{ "class" : "group-grid-field"}, defaultValue: -1}
                                ,group_role_key: {type:"number", attributes:{ "class" : "group-grid-field"}, attributes:{ "class" : "group-grid-field"}, defaultValue: -1}
                                ,group_scope_key: {type:"number", attributes:{ "class" : "group-grid-field"}, defaultValue: -1}
                                ,group_type_key: {type:"Number", attributes:{ "class" : "group-grid-field"}, defaultValue: -1}
                                ,Inactive: {type:"boolean", attributes:{ "class" : "group-grid-field"}, defaultValue:false}
                                ,ad_inactive_date: {type:"date", attributes:{ "class" : "group-grid-field"}}
                            }
                        },  
                    }  

                    ,pageSize: 18
                }
                ,height: 500
                ,change: onChange
                ,dataBound: onDataBound
                ,dataBinding: onDataBinding
                ,sort: onSorting
                ,filter: onFiltering
                ,group: onGrouping
                ,page: onPaging
                ,groupExpand: onGroupExpand
                ,groupCollapse: onGroupCollapse
                ,navigatable: true
                ,pageable: true
                ,pageable:true
                ,filterable:true
                ,sortable:true
                ,columnMenu:true
                ,toolbar: ["create", "save", "cancel","<button class='k-button group-inactive-button' >Hide Inactive</button>"]
                ,columns:
                    [    { field: "group_Key", title: "Key", width: 80, locked:true, lockable:false}
                        ,{ command: ["edit","destroy"], title: "&nbsp;", width: 200, locked:true, lockable:false}
                        ,{ field: "group_id", title: "ID", width: 320, locked:true}
                        ,{ field: "group_scope_code", title: "Scope", width: 250, editor: groupScopeCodeDropDownEditor, template: "#=group_scope_code#"}
                        ,{ field: "group_project_code", title: "Project", width: 250, editor: groupProjectCodeDropDownEditor, template: "#=group_project_code#"}
                        ,{ field: "group_role_code", title: "Role", width: 250, editor: groupRoleCodeDropDownEditor, template: "#=group_role_code#"}
                        ,{ field: "group_type_code", title: "Type", width: 250, editor: groupTypeCodeDropDownEditor, template: "#=group_type_code#"}
                        ,{ field: "group_description", title: "Description", width: 300}
                        ,{ field: "group_object_category", hidden:true , title: "Object Category", width: 90}
                        ,{ field: "project_owner", title: "Owner", width: 100}
                        ,{ field: "project_email", title: "EMail", width: 150}
                        ,{ field: "project_telephone", title: "Phone", width: 130}
                        ,{ field: "create_date", hidden:true , title: "Created", width: 90, template : '#= kendo.toString(create_date,"yyyy-MM-dd") #'}
                        ,{ field: "last_updated_date", hidden:true , title: "Updated", width: 90, template : '#= kendo.toString(last_updated_date,"yyyy-MM-dd") #'}
                        ,{ field: "inactivated_date", title: "Inactivated", width: 150, template : '#= kendo.toString(inactivated_date,"yyyy-MM-dd") #'}
                        ,{ field: "group_project_key", hidden:true, title:"Project_key"} 
                        ,{ field: "group_role_key", hidden:true, title:"Role_Key"}      
                        ,{ field: "group_scope_key", hidden:true, title:"Scope_Key"}     
                        ,{ field: "group_type_key", hidden:true, title:"Type_Key"} 
                        ,{ field: "Inactive", title: "Inactive", width: 130}
                        ,{ field: "ad_inactive_date", title:"Ad Inactive Date", width: 180, template : '#= kendo.toString(ad_inactive_date,"yyyy-MM-dd") #'}   
                    ]
                ,editable: "inline"
            });


            $("#divGrdMIPGroupScopes").kendoGrid({
                dataSource:
                    {    type: "odata-v4"
                        ,transport:
                        {
                             read: 
                            {
                                url: function()
                                {
                                    return "https://localhost:44395/OData/MIPGroupScope";
                                }
                            }
                            ,update:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupScope(" + dataItem.group_scope_key + ")";
                                    
                                }
                            }
                            ,create:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupScope";
                                }
                            }
                            ,destroy:
                                {
                                    url: function(dataItem)
                                    {
                                        return "https://localhost:44395/OData/MIPGroupScope(" + dataItem.group_scope_key + ")";
                                    }
                                }
                            ,parameterMap: function(data,type)
                            {
                                console.log(type);
                                if (type == "create")
                                {
                                    delete data.group_scope_key;
                                    return kendo.stringify(data);
                                }
                                console.log(data);
                                return kendo.stringify(data);
                            }
                        }                            
                        ,sort:
                        { 
                             field:'group_scope_key'
                            ,dir: 'desc'
                        }
                        ,schema:
                        {    
                            model:
                            {
                                id: "group_scope_key"
                                ,fields: 
                                {
                                 group_scope_key:  {editable:false, type: "number", attributes:{ "class" : "scope-grid-field"} } 
                                ,group_scope_code: {type:"string", attributes:{ "class" : "scope-grid-field"}
                                                //   , validation: {  required: true
                                                //                  , validateGroupScopeCode : function(input)
                                                //                                 {
                                                //                                     if (input.is("[name='group_scope_code']") && input.val().length > 6)
                                                //                                     {
                                                //                                         input.attr("data-validateGroupScopeCode-msg","Length exceeds max of 6 characters");
                                                //                                         return false;
                                                //                                     }
                                                //                                 }
                                                //                             }
                                                   } 
                                ,group_scope_name: {  type:"string", attributes:{ "class" : "scope-grid-field"}
                                                     ,defaultValue: null
                                                    //  ,validation:{  required: false
                                                    //                 ,validateGroupScopeName : function(input)
                                                    //                             {
                                                    //                                 if (input.is("[name='group_scope_name']") && input.val().length > 50)
                                                    //                                 {
                                                    //                                     input.attr("data-validateGroupScopeName-msg","Length exceeds max of 50 characters");
                                                    //                                     return false;
                                                    //                                 }
                                                    //                             }}
                                                    }
                                ,group_scope_description: { type:"string", attributes:{ "class" : "scope-grid-field"}
                                                          , defaultValue: null
                                                        //   , validation: {   required:false
                                                        //                     ,validateGroupScopeDescription : function(input)
                                                        //                         {
                                                        //                             if (input.is("[name=',group_scope_description']") && input.val().length > 255)
                                                        //                             {
                                                        //                                 input.attr("data-validateGroupScopeDescription-msg","Length exceeds max of 255 characters");
                                                        //                                 return false;
                                                        //                             }
                                                        //                         }
                                                        //                     }
                                                        }
                                ,Inactive: {type:"boolean", attributes:{ "class" : "scope-grid-field"}, defaultValue:false}
                                }
                            }
                        }
                        ,pageSize: 18
                    }
                ,height: 500
                ,change: onChange
                ,dataBound: onDataBound
                ,dataBinding: onDataBinding
                ,sort: onSorting
                ,filter: onFiltering
                ,group: onGrouping
                ,page: onPaging
                ,groupExpand: onGroupExpand
                ,groupCollapse: onGroupCollapse
                ,navigatable: true
                ,pageable: true
                ,pageable:true
                ,filterable:true
                ,sortable:true
                ,columnMenu:true
                // ,toolbar: ["create", "save", "cancel","Hide Inactive"]
                ,toolbar: ["create", "save", "cancel","<button class='k-button scope-inactive-button' >Hide Inactive</button>"]
                ,columns:
                    [    { field: "group_scope_key", title: "Key", width: 80, locked:true, lockable:false}
                        ,{command: ["edit", "destroy"], title: "&nbsp;", width: 200, locked:true, lockable:false}
                        ,{ field: "group_scope_code", title: "Code", width: 80, locked:true, lockable:false }
                        ,{ field: "group_scope_name", title: "Name", width: 380 }
                        ,{ field: "group_scope_description", title: "Description", width: 400}
                        ,{ field: "Inactive", title: "Inactive", width: 120}
                    ]
                ,editable: "inline"
            });

            $("#divGrdMIPGroupProjects").kendoGrid({
                dataSource:
                    {    type: "odata-v4"
                        ,transport:
                        {
                             read: 
                            {
                                url: function()
                                {
                                    return "https://localhost:44395/OData/MIPGroupProject";
                                }
                            }
                            ,update:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupProject(" + dataItem.group_project_key + ")";
                                    
                                }
                            }
                            ,create:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupProject";
                                }
                            }
                            ,destroy:
                                {
                                    url: function(dataItem)
                                    {
                                        return "https://localhost:44395/OData/MIPGroupProject(" + dataItem.group_project_key + ")";
                                    }
                                }
                            ,parameterMap: function(data,type)
                            {
                                console.log(type);
                                if (type == "create")
                                {
                                    delete data.group_project_key;
                                    return kendo.stringify(data);
                                }
                                console.log(data);
                                return kendo.stringify(data);
                            }
                        }                            
                        ,sort:
                        { 
                             field:'group_project_key'
                            ,dir: 'asc'
                        }
                        ,schema:
                        {    
                            model:
                            {
                                id: "group_project_key"
                                ,fields: 
                                {
                                 group_project_key:  {editable:false, type: "number" } 
                                ,group_project_code: {type:"string"
                                , attributes:{ "class" : "project-grid-field"}
                                , validation: {  required: (function(input)
                                                                     {
                                                                            if ($(input).hasClass("project-grid-field"))
                                                                            {
                                                                                return true;
                                                                            }
                                                                            else
                                                                            {
                                                                                return false;
                                                                            }
                                                                     })
                                                                   , validateGroupProjectCode : function(input)
                                                                                {
                                                                                    if (input.is("[name='group_project_code']") && input.val().length > 20)
                                                                                    {
                                                                                        input.attr("data-validateGroupProjectCode-msg","Length exceeds max of 20 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }
                                                                            }
                                                   } 
                                ,group_project_name: { type:"string"
                                                     , attributes:{ "class" : "project-grid-field"}
                                                     , defaultValue: null
                                                     , validation:{ validateGroupProjectName : function(input)
                                                                                {
                                                                                    if (input.is("[name='group_project_name']") && input.val().length > 50)
                                                                                    {
                                                                                        input.attr("data-validateGroupProjectName-msg","Length exceeds max of 50 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }}}
                                ,group_project_description: {type:"string"
                                                            , attributes:{ "class" : "project-grid-field"}
                                                            , defaultValue: null
                                                            , validation: {  validateGroupProjectDescription : function(input)
                                                                                    {
                                                                                        if (input.is("[name=',group_project_description']") && input.val().length > 255)
                                                                                        {
                                                                                            input.attr("data-validateGroupProjectDescription-msg","Length exceeds max of 255 characters");
                                                                                            return false;
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            return true;
                                                                                        }
                                                                                    }
                                                                                }
                            }
                                ,Inactive: {type:"boolean", attributes:{ "class" : "project-grid-field"}, defaultValue:false}
                                }
                            }
                        }
                        ,pageSize: 18
                    }
                ,height: 500
                ,change: onChange
                ,dataBound: onDataBound
                ,dataBinding: onDataBinding
                ,sort: onSorting
                ,filter: onFiltering
                ,group: onGrouping
                ,page: onPaging
                ,groupExpand: onGroupExpand
                ,groupCollapse: onGroupCollapse
                ,navigatable: true
                ,pageable: true
                ,pageable:true
                ,filterable:true
                ,sortable:true
                ,columnMenu:true
                // ,toolbar: ["create", "save", "cancel","Hide Inactive"]
                ,toolbar: ["create", "save", "cancel","<button class='k-button project-inactive-button' >Hide Inactive</button>"]
                ,columns:
                    [    { field: "group_project_key", title: "Key", width: 80, locked:true, lockable:false}
                        ,{ field: "group_project_code", title: "Code", width: 80, locked:true, lockable:false }
                        ,{ command: ["edit","destroy"], title: "&nbsp;", width: 200, locked:true, lockable:false }
                        ,{ field: "group_project_name", title: "Name", width: 380 }
                        ,{ field: "group_project_description", title: "Description", width: 400}
                        ,{ field: "Inactive", title: "Inactive", width: 120}
                    ]
                ,editable: "inline"
            });

            $("#divGrdMIPGroupRoles").kendoGrid({
                dataSource:
                    {    type: "odata-v4"
                        ,transport:
                        {
                             read: 
                            {
                                url: function()
                                {
                                    return "https://localhost:44395/OData/MIPGroupRole";
                                }
                            }
                            ,update:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupRole(" + dataItem.group_role_key + ")";
                                    
                                }
                            }
                            ,create:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupRole";
                                }
                            }
                            ,destroy:
                                {
                                    url: function(dataItem)
                                    {
                                        return "https://localhost:44395/OData/MIPGroupRole(" + dataItem.group_role_key + ")";
                                    }
                                }
                            ,parameterMap: function(data,type)
                            {
                                console.log(type);
                                if (type == "create")
                                {
                                    delete data.group_role_key;
                                    return kendo.stringify(data);
                                }
                                console.log(data);
                                return kendo.stringify(data);
                            }
                        }                            
                        ,sort:
                        { 
                             field:'group_role_key'
                            ,dir: 'asc'
                        }
                        ,schema:
                        {    
                            model:
                            {
                                id: "group_role_key"
                                ,fields: 
                                {
                                 group_role_key:  {editable:false, type: "number" } 
                                ,group_role_code: {   type:"string"
                                                    , attributes:{ "class" : "role-grid-field"}
                                                    , validation: {required: (function(input)
                                                                    {
                                                                            if ($(input).hasClass("scope-grid-field"))
                                                                            {
                                                                                return true;
                                                                            }
                                                                            else
                                                                            {
                                                                                return false;
                                                                            }
                                                                    })
                                                                    , validateGroupRoleCode : function(input)
                                                                                    {
                                                                                        if (input.is("[name='group_role_code']") && input.val().length > 20)
                                                                                        {
                                                                                            input.attr("data-validateGroupRoleCode-msg","Length exceeds max of 20 characters");
                                                                                            return false;
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            return true;
                                                                                        }
                                                                                    }
                                                                                }
                                                   } 
                                ,group_role_name: {   type:"string"
                                                    , attributes:{ "class" : "role-grid-field"}
                                                    , defaultValue: null
                                                    ,validation:{ validateGroupRoleName : function(input)
                                                                                {
                                                                                    if (input.is("[name='group_role_name']") && input.val().length > 50)
                                                                                    {
                                                                                        input.attr("data-validateGroupRoleName-msg","Length exceeds max of 50 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }}}
                                ,group_role_description: {type:"string"
                                                         , attributes:{ "class" : "role-grid-field"}                                
                                                         , defaultValue: null
                                                         , validation: { validateGroupRoleDescription : function(input)
                                                                                {
                                                                                    if (input.is("[name=',group_role_description']") && input.val().length > 255)
                                                                                    {
                                                                                        input.attr("data-validateGroupRoleDescription-msg","Length exceeds max of 255 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }
                                                                            }
                            }
                                ,Inactive: {type:"boolean", attributes:{ "class" : "role-grid-field"}, defaultValue:false}
                                }
                            }
                        }
                        ,pageSize: 18
                    }
                ,height: 500
                ,change: onChange
                ,dataBound: onDataBound
                ,dataBinding: onDataBinding
                ,sort: onSorting
                ,filter: onFiltering
                ,group: onGrouping
                ,page: onPaging
                ,groupExpand: onGroupExpand
                ,groupCollapse: onGroupCollapse
                ,navigatable: true
                ,pageable: true
                ,pageable:true
                ,filterable:true
                ,sortable:true
                ,columnMenu:true
                // ,toolbar: ["create", "save", "cancel","Hide Inactive"]
                ,toolbar: ["create", "save", "cancel","<button class='k-button role-inactive-button' >Hide Inactive</button>"]
                ,columns:
                    [    { field: "group_role_key", title: "Key", width: 80, locked:true, lockable:false}
                        ,{ field: "group_role_code", title: "Code", width: 80, locked:true, lockable:false }
                        ,{ command: ["edit","destroy"], title: "&nbsp;", width: 200, locked:true, lockable:false}
                        ,{ field: "group_role_name", title: "Name", width: 380 }
                        ,{ field: "group_role_description", title: "Description", width: 400}
                        ,{ field: "Inactive", title: "Inactive", width: 120}
                    ]
                ,editable: "inline"

            });

            $("#divGrdMIPGroupTypes").kendoGrid({
                dataSource:
                    {    type: "odata-v4"
                        ,transport:
                        {
                             read: 
                            {
                                url: function()
                                {
                                    return "https://localhost:44395/OData/MIPGroupType";
                                }
                            }
                            ,update:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupType(" + dataItem.group_type_key + ")";
                                    
                                }
                            }
                            ,create:
                            {
                                url: function(dataItem)
                                {
                                    return "https://localhost:44395/OData/MIPGroupType";
                                }
                            }
                            ,destroy:
                                {
                                    url: function(dataItem)
                                    {
                                        return "https://localhost:44395/OData/MIPGroupType(" + dataItem.group_type_key + ")";
                                    }
                                }
                            ,parameterMap: function(data,type)
                            {
                                console.log(type);
                                if (type == "create")
                                {
                                    delete data.group_type_key;
                                    return kendo.stringify(data);
                                }
                                console.log(data);
                                return kendo.stringify(data);
                            }
                        }                            
                        ,sort:
                        { 
                             field:'group_type_key'
                            ,dir: 'asc'
                        }
                        ,schema:
                        {    
                            model:
                            {
                                id: "group_type_key"
                                ,fields: 
                                {
                                 group_type_key:  {editable:false, type: "number" } 
                                ,group_type_code: {type:"string"
                                                  , validation: {required: (function(input)
                                                                   {
                                                                        if ($(input).hasClass("scope-grid-field"))
                                                                        {
                                                                            return true;
                                                                        }
                                                                        else
                                                                        {
                                                                            return false;
                                                                        }
                                                                   })
                                                                 , validateGroupTypeCode : function(input)
                                                                                {
                                                                                    if (input.is("[name='group_type_code']") && input.val().length > 4)
                                                                                    {
                                                                                        input.attr("data-validateGroupTypeCode-msg","Length exceeds max of 4 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }
                                                                            }
                                                   } 
                                ,group_type_name: { type:"string"
                                                    , defaultValue: null
                                                    ,validation:{ validateGroupTypeName : function(input)
                                                                                {
                                                                                    if (input.is("[name='group_type_name']") && input.val().length > 35)
                                                                                    {
                                                                                        input.attr("data-validateGroupTypeName-msg","Length exceeds max of 35 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }}}
                                ,group_type_description: {type:"string"
                                                         , defaultValue: null
                                                         , validation: { validateGroupTypeDescription : function(input)
                                                                                {
                                                                                    if (input.is("[name=',group_type_description']") && input.val().length > 255)
                                                                                    {
                                                                                        input.attr("data-validateGroupTypeDescription-msg","Length exceeds max of 255 characters");
                                                                                        return false;
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        return true;
                                                                                    }
                                                                                }
                                                                            }
                            }
                                ,Inactive: {type:"boolean", defaultValue:false}
                                }
                            }
                        }
                        ,pageSize: 18
                    }
                ,height: 500
                ,change: onChange
                ,dataBound: onDataBound
                ,dataBinding: onDataBinding
                ,sort: onSorting
                ,filter: onFiltering
                ,group: onGrouping
                ,page: onPaging
                ,groupExpand: onGroupExpand
                ,groupCollapse: onGroupCollapse
                ,navigatable: true
                ,pageable: true
                ,pageable:true
                ,filterable:true
                ,sortable:true
                ,columnMenu:true
                // ,toolbar: ["create", "save", "cancel","Hide Inactive"]
                ,toolbar: ["create", "save", "cancel","<button class='k-button type-inactive-button' >Hide Inactive</button>"]
                ,columns:
                    [    { field: "group_type_key", title: "Key", width: 80, locked:true, lockable:false}
                        ,{ field: "group_type_code", title: "Code", width: 80, locked:true, lockable:false }
                        ,{ command: ["edit","destroy"], title: "&nbsp;", width: 200, locked:true, lockable:false }
                        ,{ field: "group_type_name", title: "Name", width: 380 }
                        ,{ field: "group_type_description", title: "Description", width: 400}
                        ,{ field: "Inactive", title: "Inactive", width: 120}
                    ]
                ,editable: "inline"

            });


            $(".group-inactive-button").click(function()
            {
                console.log("toogle inactive");
                console.log($(this));
                console.log($(this).parent);
                var grid = $("#divGrdADGroups").data("kendoGrid");
                var datasource = grid.dataSource;
                var currentFilter = datasource.filter();
                console.log(currentFilter);
                var activeOnlyFilter = 
                {
                      field: "Inactive"
                    , operator: "neq"
                    , value: "true"
                };
                console.log(activeOnlyFilter)
                if ($(this).text() == "Hide Inactive")
                {
                    if (currentFilter == undefined)
                    {
                        datasource.filter(activeOnlyFilter);
                    }
                    else
                    {
                        currentFilter.filters.push(activeOnlyFilter);
                        datasource.filter(currentFilter)
                    }

                    $(this).text("Show Inactive"); 
                }
                else
                {
                    $(this).text("Hide Inactive"); 
                    datasource.filter({})
                }
                console.log($(this).text());            
            })

            $(".scope-inactive-button").click(function()
            {
                console.log("Clicked Scope Inactive Hide");

                var grid = $("#divGrdMIPGroupScopes").data("kendoGrid");
                var datasource = grid.dataSource;
                var currentFilter = datasource.filter();
                console.log(currentFilter);
                var activeOnlyFilter = 
                {
                      field: "Inactive"
                    , operator: "neq"
                    , value: "true"
                };
                console.log(activeOnlyFilter)
                if ($(this).text() == "Hide Inactive")
                {
                    if (currentFilter == undefined)
                    {
                        datasource.filter(activeOnlyFilter);
                    }
                    else
                    {
                        currentFilter.filters.push(activeOnlyFilter);
                        datasource.filter(currentFilter)
                    }

                    $(this).text("Show Inactive"); 
                }
                else
                {
                    $(this).text("Hide Inactive"); 
                    datasource.filter({})
                }
                console.log($(this).text());                   
            })

            $(".project-inactive-button").click(function()
            {
                console.log("Clicked Project Inactive Hide");

                var grid = $("#divGrdMIPGroupProjects").data("kendoGrid");
                var datasource = grid.dataSource;
                var currentFilter = datasource.filter();
                console.log(currentFilter);
                var activeOnlyFilter = 
                {
                      field: "Inactive"
                    , operator: "neq"
                    , value: "true"
                };
                console.log(activeOnlyFilter)
                if ($(this).text() == "Hide Inactive")
                {
                    if (currentFilter == undefined)
                    {
                        datasource.filter(activeOnlyFilter);
                    }
                    else
                    {
                        currentFilter.filters.push(activeOnlyFilter);
                        datasource.filter(currentFilter)
                    }

                    $(this).text("Show Inactive"); 
                }
                else
                {
                    $(this).text("Hide Inactive"); 
                    datasource.filter({})
                }
                console.log($(this).text());                   
            })

            $(".role-inactive-button").click(function()
            {
                console.log("Clicked Role Inactive Hide");

                var grid = $("#divGrdMIPGroupRoles").data("kendoGrid");
                var datasource = grid.dataSource;
                var currentFilter = datasource.filter();
                console.log(currentFilter);
                var activeOnlyFilter = 
                {
                      field: "Inactive"
                    , operator: "neq"
                    , value: "true"
                };
                console.log(activeOnlyFilter)
                if ($(this).text() == "Hide Inactive")
                {
                    if (currentFilter == undefined)
                    {
                        datasource.filter(activeOnlyFilter);
                    }
                    else
                    {
                        currentFilter.filters.push(activeOnlyFilter);
                        datasource.filter(currentFilter)
                    }

                    $(this).text("Show Inactive"); 
                }
                else
                {
                    $(this).text("Hide Inactive"); 
                    datasource.filter({})
                }
                console.log($(this).text());                   
            })

            $(".type-inactive-button").click(function()
            {
                console.log("Clicked Type Inactive Hide");

                var grid = $("#divGrdMIPGroupTypes").data("kendoGrid");
                var datasource = grid.dataSource;
                var currentFilter = datasource.filter();
                console.log(currentFilter);
                var activeOnlyFilter = 
                {
                      field: "Inactive"
                    , operator: "neq"
                    , value: "true"
                };
                console.log(activeOnlyFilter)
                if ($(this).text() == "Hide Inactive")
                {
                    if (currentFilter == undefined)
                    {
                        datasource.filter(activeOnlyFilter);
                    }
                    else
                    {
                        currentFilter.filters.push(activeOnlyFilter);
                        datasource.filter(currentFilter)
                    }

                    $(this).text("Show Inactive"); 
                }
                else
                {
                    $(this).text("Hide Inactive"); 
                    datasource.filter({})
                }
                console.log($(this).text());                   
            })


            function groupScopeCodeDropDownEditor(container,options)
            {
                $('<input required name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList(
                        {    autoBind: false
                            ,dataTextField: "group_scope_code"
                            ,dataValueField: "group_scope_code"
                            ,dataSource:
                            {
                                 type: "odata-v4"
                                ,transport :
                                    {
                                        read: "https://localhost:44395/OData/MIPGroupScope"
                                    }

                            }
                        }
                    )
            }

            function groupTypeCodeDropDownEditor(container,options)
            {
                $('<input required name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList(
                        {    autoBind: false
                            ,dataTextField: "group_type_code"
                            ,dataValueField: "group_type_code"
                            ,dataSource:
                            {
                                 type: "odata-v4"
                                ,transport :
                                    {
                                        read: "https://localhost:44395/OData/MIPGroupType"
                                    }

                            }
                        }
                    )
            }
            
            function groupProjectCodeDropDownEditor(container,options)
            {
                $('<input required name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList(
                        {    autoBind: false
                            ,dataTextField: "group_project_code"
                            ,dataValueField: "group_project_code"
                            ,dataSource:
                            {
                                 type: "odata-v4"
                                ,transport :
                                    {
                                        read: "https://localhost:44395/OData/MIPGroupProject"
                                    }

                            }
                        }
                    )
            }

            function groupRoleCodeDropDownEditor(container,options)
            {
                $('<input required name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList(
                        {    autoBind: false
                            ,dataTextField: "group_role_code"
                            ,dataValueField: "group_role_code"
                            ,dataSource:
                            {
                                 type: "odata-v4"
                                ,transport :
                                    {
                                        read: "https://localhost:44395/OData/MIPGroupRole"
                                    }

                            }
                        }
                    )
            }


            $(".k-grid-save-changes").click(function()
            {
                console.log("update selected")
            })
       
            function onChange(arg)
            {
                console.log("entered on change");
                var selected = $.map(this.select(), function(item)
                {
                    return $(item).text();
                });

                console.log("Selected: " + selected.length + " item(s), [" + selected.join(", ") + "]");
            }

            function onDataBound(arg) {
                console.log("Grid data bound");
            }

            function onDataBinding(arg) {
                console.log("Grid data binding");
            }

            function onSorting(arg) {
                console.log("Sorting on field: " + arg.sort.field + ", direction:" + (arg.sort.dir || "none"));
            }

            function onFiltering(arg) {
                console.log("Filter on " + kendo.stringify(arg.filter));
            }

            function onPaging(arg) {
                console.log("Paging to page index:" + arg.page);
            }

            function onGrouping(arg) {
                console.log("Group on " + kendo.stringify(arg.groups));
            }

            function onGroupExpand(arg) {
                console.log("The group to be expanded: " + kendo.stringify(arg.group));
            }

            function onGroupCollapse(arg) {
                console.log("The group to be collapsed: " + kendo.stringify(arg.group));
            }  

        }

</script>
</body>
</html>